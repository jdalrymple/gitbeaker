FROM mcr.microsoft.com/playwright:v1.55.0-noble

# Enable Corepack for Yarn
RUN corepack enable

WORKDIR /app

# Copy package files first for better layer caching
COPY package.json yarn.lock .yarnrc.yml ./
COPY .yarn/releases .yarn/releases

# Install dependencies (will be cached if package files haven't changed)
RUN yarn install

# Now copy the rest of the project
COPY . .

# Add node_modules/.bin to PATH so NX can find build tools like tsup
ENV PATH="/app/node_modules/.bin:$PATH"

# Run build
RUN yarn build

CMD ["echo", "Ready"]