FROM mcr.microsoft.com/playwright:v1.55.0-noble

# Enable Corepack for Yarn
RUN corepack enable

WORKDIR /app

# Copy package files first for better layer caching
COPY package.json yarn.lock .yarnrc.yml ./
COPY .yarn/releases .yarn/releases

# Install dependencies (will be cached if package files haven't changed)
RUN yarn install

# Now copy the rest of the project
COPY . .

# Build the project (commented out due to TS errors in current branch)
# RUN yarn build

# Add swc/core for builds
RUN yarn add @swc/core

# Browsers are pre-installed in base image - no need to install again
# Base image has browsers for Playwright v1.55.0 which matches project dependency

CMD ["echo", "Ready"]